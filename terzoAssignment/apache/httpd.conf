# httpd.conf (Configurazione Finale e Funzionante per Apache)

ServerRoot "/usr/local/apache2"
Listen 80

# --- Caricamento Moduli Fondamentali ---

# Modulo per la gestione dei processi e della sicurezza su sistemi Unix/Linux (RISOLVE L'ERRORE)
LoadModule unixd_module modules/mod_unixd.so

# Modulo per il multithreading
LoadModule mpm_event_module modules/mod_mpm_event.so

# Modulo per le regole di accesso (es. "Require all granted")
LoadModule authz_core_module modules/mod_authz_core.so

# Modulo per la configurazione dei log
LoadModule log_config_module modules/mod_log_config.so

# Modulo per l'impostazione dei tipi di file (MIME types)
LoadModule mime_module modules/mod_mime.so

# Modulo per la gestione delle directory (es. "DirectoryIndex")
LoadModule dir_module modules/mod_dir.so

# Moduli per l'inoltro delle richieste a PHP-FPM
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so

# --- Configurazione Generale del Server ---
ServerAdmin admin@example.com
ServerName localhost

# Utente e Gruppo con cui il server girer√† (dopo aver abbassato i privilegi)
User www-data
Group www-data

DocumentRoot "/usr/local/apache2/htdocs"
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    DirectoryIndex index.html index.php
</Directory>

# Inoltra le richieste .php al container PHP-FPM
ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://php-fpm:9000/var/www/html/$1

# --- Configurazione dei Log ---
ErrorLog /proc/self/fd/2
LogLevel warn

CustomLog /proc/self/fd/1 \
  "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\""
